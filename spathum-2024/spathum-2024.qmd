---
title: 'Causes of ethnic segregation in a nineteenth century city'
subtitle: 'The case of Vyborg'
author: 'Antti Härkönen'
institute: UEF
date: 2024-09-26
echo: false
warning: false
bibliography: references.bib
execute:
    enabled: true
format: 
    revealjs:
        theme: simple
        incremental: true
        navigation-mode: vertical
        transition: convex
---

# Introduction

## Vyborg, a Karelian city

:::{.content-visible unless-format="pdf"}
```{python}
from ipyleaflet import Map, Marker, basemaps, basemap_to_tiles
m = Map(
  basemap=basemap_to_tiles(
    basemaps.OpenTopoMap
  ),
  center=(60.715591, 28.729147),
  zoom=5
)
m.add_layer(Marker(location=(60.715591, 28.729147)))
m
```
:::

:::{.content-visible when-format="pdf"}
![](vyborg-loc.png){fig-alt="Location of Vyborg on map"}
:::

## Vyborg, a Karelian city

- castle founded in the late 13th century
- town privileges 1403

# Sources

## Estimating the size of Russian population

- over 90% of Orthodox in Vyborg Russian

## Poll tax records {.scrollable .smaller}

| column | description |
|---:|:---|
| plot_number | Plot number |
| taxpayer_men | Men paying poll tax |
| taxpayer_women | Women paying poll tax |
| no_tax_men | Men exempt from poll tax |
| no_tax_women | Women exempt from poll tax |
| in_russia_men | Men legally residing in Russia proper |
| in_russia_women | Women legally residing in Russia proper |
| total_men | Total men |
| total_women | Total women |
| independent | Civil servants, entrepreneurs, and financially independent |
| white_collar | White collar workers |
| worker_industry | Workers in industry |
| worker_other | Other workers |
| servants | Servants |
| other | Other employment status |
| non_resident | Resident elsewhere |
| orthodox | Orthodox |
| other_christian | Non-Lutheran and non-Orthodox Christian |
| other_religion | Other religions |
| draftable | 21-year-old males eligible for draft |

: poll tax record columns in 1894 {.striped .hover}

## Estimating the size of Lutheran population

:::{.content-visible unless-format="pdf"}
$$
\begin{equation} P_{Lutheran} = \begin{split} (P_{total\_men}+P_{total\_women}) \\ − (P_{Orthodox}+P_{other\_Christian}+P_{other\_religion}) \end{split} \end{equation}
$$
:::

:::{.content-visible when-format="pdf"}
$$
P_{Lutheran} = (P_{total\_men}+P_{total\_women}) − (P_{Orthodox}+P_{other\_Christian}+P_{other\_religion})
$$
:::

## Work flow

![](workflow.jpeg){fig-alt="Flow chart of workflow"}

## Sources {.smaller}

Signum | Original year | Digitization process
---|---|---
Town plan of Vyborg. Vyborg military engineer detachment’s archive of plans for fortifications and buildings, 7, 11. | 1878 | Georeferenced using ground control points, vectorized manually into shapefile
Vyborg province poll tax registers | 1880 | Digitized manually into CSV
Financial office of the city of Vyborg, Municipal tax levies and payment registers | 1880 | Digitized manually into CSV

: Sources from the National archives of Finland {.striped .hover}

##

![](vyborg_1839.jpeg){fig-alt="Map of Vyborg in 1839"}

## Population growth

| District | 1822 | 1880 |
|----------|------|------|
| Centre   | 1192 | 2506 |
| St. Anna | 244 | 117 |
| Vyborg suburb | 642 | 756 |
| St Petersburg suburb | 1512 | 2685 |

: Population growth in key areas {.striped .hover}

# Population surface model

## Population surface model {.smaller}

:::{.fragment .fade-in-then-out}
Based on @martin2000.
:::

:::{.fragment}
$$
P_i=\sum^N_{j=1} P_j w_{ij}
$$
:::

:::{.fragment .fade-in .content-visible unless-format="pdf"}
$$
w_{ij} = 
\begin{cases} 
  \left( \frac{k^2 - d^2_{ij}}{k^2 + d^2_{ij}} \right)^\alpha & \text{if} \hspace{1cm} d_{ij < k} \\
  0 & \text{else}
\end{cases} 
$$
:::


## Biweight kernel

:::{.content-visible unless-format="pdf"}
```{python}
#| label: kernel profile
#| fig-cap: Kernel function
#| fig-alt: Side profile of a biweight kernel function

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px

α = np.repeat([0.5, 1, 1.5, 2, 5], repeats=99)
k=1

d = np.tile(np.arange(0.01, 1, 0.01), reps=5)
y = np.power((k**2 - d**2) / (k**2 + d**2), α)
y[d>=k] = 0

df = pd.DataFrame({'alpha': α, 'd': d, 'y': y})

fig = px.line(
  df,
  x='d',
  y='y',
  animation_frame='alpha', 
)
fig.show()
```
:::

:::{.content-visible when-format="pdf"}
```{python}
#| label: kernel profile pdf
#| fig-cap: Kernel function
#| fig-alt: Side profile of a biweight kernel function

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

α = np.repeat([0.5, 1, 2, 5], repeats=99)
k=1

d = np.tile(np.arange(0.01, 1, 0.01), reps=4)
y = np.power((k**2 - d**2) / (k**2 + d**2), α)
y[d>=k] = 0

df = pd.DataFrame({'alpha': α, 'd': d, 'y': y})

fig, axs = plt.subplots(4, sharex=True, figsize=(4,8))
for i, a in enumerate(df['alpha'].unique()):
  df.loc[df['alpha']==a].plot.line(
    x='d',
    y='y',
    legend=False,
    title=f'alpha={a}',
    ax=axs[i],
  )
plt.show()
```
:::

# Segregation

## 1700s

##

![](vyborg_1768.jpeg){fig-alt="Map Vyborg plot owners in 1768"}

##

![](orthodox_density.jpeg){fig-alt="Map of density of Orthodox population"}

##

![](income.jpeg){fig-alt="Map of income distribution in Vyborg"}

# Explaining segregation

## Regression model (1) {.smaller}

::: {.fragment}
$$
O_i \sim MvNormal(\mu, \textbf{K})
$$
:::

::: {.fragment}
$$
\mu_i = \beta_{0,k[i]} + \beta_{1,k[i]} \textit{ln(W)} + \beta_{2,k[i]} C_i
$$
:::

::: {.fragment .fade-in-then-out}
$$
k \in 1,2,3,4 \hspace{1cm} i,j \in 1,2,3, \dots 539
$$
:::

::: {.fragment}
$$
\beta_k \sim MvNormal \left( 
  \theta, 
  \begin{bmatrix} 
    0.1 & 0 & 0 \\
    0 & 0.1 & 0 \\
    0 & 0 & 0.1
  \end{bmatrix}\right)
$$
:::

::: {.fragment}
$$ 
\theta \sim MvNormal \left( 
  \begin{bmatrix} 
    0 \\
    0 \\
    0
  \end{bmatrix}, 
  \begin{bmatrix} 
    0.1 & 0 & 0 \\
    0 & 0.1 & 0 \\
    0 & 0 & 0.1
  \end{bmatrix}\right)
$$
:::

## Regression model (2)

::: {.fragment}
$$
\textbf{K}_{ij} = \eta^2 exp(-75 \rho^2 d^2_{ij}) + 0.01 \times I_{540}
$$
:::

::: {.fragment}
$$
\eta^2 \sim Normal(1, 0.2)
$$
$$
\rho^2 \sim Normal(1, 0.2)
$$
:::

## Multilevel Bayesian regression {.scrollable .smaller}

Variable | Shape | Description
----|-----|-----
O |	540	| Normalized proportion of Russian Orthodox of the local population
W | 540	| Smoothed total income in a location in öre
C | 540	| Distance to nearest Orthodox church in 1799 in kilometres
d | 540 x 540 |	Distance matrix holding pairwise distances between plots
θ | 3	| Hyperparameter for β
β | 4 x 3 |	Linear regression coefficients for each district
η2 | 1 | Parameter for the covariance function
ρ2 | 1 | Parameter for the covariance function

##

![](plate_diagram_1.jpeg){fig-alt="Plate diagram of Bayesian regression model"}

## Results {.scrollable .smaller}

Variable | Mean | SD | HDI, 95% |
:---|:---|:---|---:|:---
θ0 | −0.027	| 0.096 | −0.227 | 0.15
θ1 | 0.027 |	0.085	| −0.142 | 0.193
θ2 | −0.135 | 0.096 | −0.309 | 0.067
β0,0 | −0.609 | 0.299 | −1.162 | −0.013
β0,1 | 0.104 | 0.056 | −0.009 | 0.209
β0,2 | −1.076 | 0.314 | −1.702 | −0.487
β1,0 | 0.097 | 0.3 | −0.46 | 0.743
β1,1 | 0.142 | 0.14 | −0.117 | 0.433
β1,2 | −0.037 | 0.316 | −0.625 | 0.626
β2,0 | 0.118 | 0.299 | −0.509 | 0.677
β2,1 | 0.119 | 0.074 | −0.024 | 0.261
β2,2 | −0.287 | 0.312 | −0.905 | 0.306
β3,0 | 0.016 | 0.272 | −0.54 | 0.515
β3,1 | 0 | 0.069 | −0.141 | 0.135
β3,2 | −0.496 | 0.248 | −0.991 | −0.024
scaled η² | 0.93 |	0.04 | 0.852 | 1.006
ρ² | 1.0 | 0.099 | 0.812 | 1.194

# References
